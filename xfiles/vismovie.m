function Stim =  vismovie(pars,myscreen,flag);% Stim =  vismovie(pars,myscreen);%% code for vismovie.x%% example:	pars = [ 9003 0 0 ];% 			myscreen = ltScreenInitialize(1);%			myscreen.Dist = 57;%% 2000-07 MC% 2001-05 MC & VM% 2001-07 VM introduced flag, corrected little position bug% 2001-09 VM introduced 'donotchangeseq'% 2002-04 MC told makeoffscreenwindows to remove the frame data (to save space)% 2009-04 MC told it about zserverif nargin<3   flag = '';endif exist('zmac:Movies:CatCam','dir')	MovieDir = 'zmac:Movies:CatCam';elseif exist('zbigmac:Movies:','dir')	MovieDir = 'zbigmac:Movies:';% elseif exist('\\zamboni\share\mac pub\Movies','dir')% 	MovieDir = '\\zamboni\share\mac pub\Movies';% elseif exist('Z:\movies','dir')% 	MovieDir = 'Z:\movies';elseif exist('\\zeon\share\Data\movies','dir')	MovieDir = '\\zeon\share\Data\movies';elseif exist('\\zserver\Data\movies','dir')	MovieDir = '\\zserver\Data\movies';else   Stim = [];   disp(['could not find the movies...']);	returnend% ------ parse the pars (excuse the pun) and convert 10*deg to pixctr.x = ceil(ltdeg2pix(pars(2)/10,myscreen));ctr.y = ceil(ltdeg2pix(pars(3)/10,myscreen));%-------------------filename = fullfile(MovieDir,num2str(pars(1)));load(filename);% defines Stim.frames{1}, and maybe imagerate as well% imagerate = 125; save(filename,'Stim','imagerate');if exist('donotchangeseq') ~= 1   if exist('imagerate')~=1      imagerate = 25; % Hz   endend%-------------------% define the look-up tables for this stimuluslinClut = [ [128 128 128]; [255 255 255]; [  1   1   1]; round(linspace(1,255,253))'*[1 1 1] ];Stim.luts{1} = linClut;%-------------------[ny, nx] = size(Stim.frames{1}{1});nimages = length(Stim.frames{1});% coords of center of stimulus with respect to the top left of the screenx = ctr.x + myscreen.Xmax/2;y = ctr.y + myscreen.Ymax/2;% coords of top left of stimulus with respect to the top left of the screenx = x - round(nx/2);y = y - round(ny/2);Stim.position(1,:) = [x,y,x+nx,y+ny];%------------------- define the sequences for the frames and the lutsif exist('donotchangeseq') ~= 1   duration = nimages/imagerate; % seconds   nframes = ceil(duration*myscreen.FrameRate);   frameseq = NaN*ones(1,nframes);   imagetimes = linspace(0,duration,nimages+1); % in s   imageframes = ceil(imagetimes(1:end-1)*myscreen.FrameRate)+1;   frameseq(imageframes) = [1:nimages];else   nframes = length(Stim.frames{1})   frameseq = 1:nframes;endStim.sequence.frames = frameseq;Stim.sequence.luts = ones(1,nframes);% define the number of times you want to see the movieStim.nperiods = 1;if ~strcmp(flag,'analysis')	Stim = ltMakeOffScreenWindows(myscreen,Stim,0);endreturn%--------------------------------------------------------------------------------------------% TO TEST IT:myscreen = ltScreenInitialize(1);		myscreen.Dist = 65;ltLoadCalibration(myscreen,3);Stim = vismovie([ 7002 0 0 ],myscreen);vsPlayStimulus(myscreen,Stim,'norush');	vsPlayStimulus(myscreen,Stim);ltClearStimulus(Stim,'nowarnings'); SCREEN('CloseAll');